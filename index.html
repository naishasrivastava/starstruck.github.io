<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>starstruck - constellation maker</title>
    <link rel="icon" type="image/png" href="fav.png">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #fffbeb;
            color: #78350f;
            line-height: 1.6;
            background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulance type='fractalNoise' baseFrequency='0.9' numOctaves='4' /%3E%3CfeColorMatrix type='saturate' values='0'/%3E%3C/filter%3E%3Crect width='100' height='100' filter='url(%23noise)' opacity='0.05'/%3E%3C/svg%3E");
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            width: 100%;
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 2rem 2rem 1rem 2rem;
        }

        h1 {
            font-size: 4rem;
            font-weight: 900;
            text-transform: lowercase;
            color: #78350f;
            margin-bottom: 0.75rem;
            text-align: center;
        }

        .subtitle {
            font-size: 1.25rem;
            font-weight: 700;
            text-transform: lowercase;
            color: #92400e;
            text-align: center;
            margin-bottom: 3rem;
        }

        .main-layout {
            display: grid;
            grid-template-columns: 320px 1fr;
            gap: 2.5rem;
            margin-bottom: 2rem;
            align-items: start;
        }

        .controls-panel {
            background: white;
            padding: 2rem;
            border: 2px solid #78350f;
            box-shadow: 6px 6px 0px rgba(120, 53, 15, 0.15);
            display: flex;
            flex-direction: column;
            gap: 1.75rem;
            height: fit-content;
            position: sticky;
            top: 2rem;
        }

        .controls-row {
            display: flex;
            flex-direction: column;
            gap: 1.75rem;
        }

        .control-section {
            padding-bottom: 1.75rem;
            border-bottom: 2px solid #fef3c7;
        }

        .control-section:last-child {
            border-bottom: none;
            padding-bottom: 0;
        }

        .control-section h3 {
            font-size: 1rem;
            font-weight: 900;
            text-transform: lowercase;
            color: #1d4ed8;
            margin-bottom: 1rem;
        }

        .color-picker-group {
            margin-bottom: 0.75rem;
        }

        .color-picker-group:last-child {
            margin-bottom: 0;
        }

        .color-picker {
            width: 100%;
            height: 50px;
            border: 2px solid #78350f;
            border-radius: 4px;
            cursor: pointer;
        }

        .btn {
            width: 100%;
            padding: 0.875rem;
            font-weight: 700;
            text-transform: lowercase;
            border: 2px solid #78350f;
            background: #2563eb;
            color: white;
            cursor: pointer;
            margin-bottom: 0.625rem;
            font-size: 0.875rem;
            transition: all 0.3s;
            box-shadow: 3px 3px 0px rgba(120, 53, 15, 0.15);
        }

        .btn:last-child {
            margin-bottom: 0;
        }

        .btn:hover:not(:disabled):not(.btn-surprise):not(.btn-secondary) {
            background: #1d4ed8;
            transform: translateY(-2px);
            box-shadow: 4px 4px 0px rgba(120, 53, 15, 0.2);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-secondary {
            background: white;
            color: #78350f;
        }

        .btn-secondary:hover:not(:disabled) {
            background: #fff4ca !important;
            color: #78350f !important;
            transform: translateY(-2px);
            box-shadow: 4px 4px 0px rgba(120, 53, 15, 0.2);
        }

        .btn-surprise {
            background: linear-gradient(135deg, #5C81F6 0%, #9B87F5 100%);
            border: 2px solid #78350f;
            color: white;
            font-size: 0.875rem;
            margin-bottom: 0.625rem;
            position: relative;
            overflow: hidden;
        }

        .btn-surprise:last-child {
            margin-bottom: 0;
        }

        .btn-surprise:hover:not(:disabled) {
            background: linear-gradient(135deg, #4A6FD4 0%, #8975D3 100%) !important;
            transform: translateY(-2px) scale(1.02);
            box-shadow: 4px 4px 0px rgba(120, 53, 15, 0.2);
        }

        .sparkle {
            position: absolute;
            pointer-events: none;
            animation: sparkle-anim 0.7s ease forwards;
            font-size: 1.1rem;
        }

        @keyframes sparkle-anim {
            0%   { opacity: 1; transform: translate(-50%, -50%) scale(0.5); }
            50%  { opacity: 1; transform: translate(-50%, -50%) scale(1.4); }
            100% { opacity: 0; transform: translate(-50%, -120%) scale(1); }
        }

        .tool-selector {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.625rem;
        }

        .tool-btn {
            padding: 0.75rem;
            font-weight: 700;
            text-transform: lowercase;
            border: 2px solid #78350f;
            background: white;
            color: #78350f;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.2s;
            box-shadow: 2px 2px 0px rgba(120, 53, 15, 0.15);
        }

        .tool-btn.active {
            background: #2563eb;
            color: white;
        }

        .tool-btn:hover {
            transform: translateY(-1px);
            box-shadow: 3px 3px 0px rgba(120, 53, 15, 0.2);
        }

        .slider-group {
            margin-bottom: 0.75rem;
        }

        .slider-group:last-child {
            margin-bottom: 0;
        }

        .slider-group label {
            display: block;
            font-size: 0.875rem;
            font-weight: 700;
            text-transform: lowercase;
            color: #78350f;
            margin-bottom: 0.5rem;
        }

        input[type="range"] {
            width: 100%;
            height: 8px;
            background: #fef3c7;
            outline: none;
            border: 2px solid #78350f;
            -webkit-appearance: none;
            border-radius: 4px;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: #2563eb;
            cursor: pointer;
            border: 2px solid #78350f;
            border-radius: 50%;
        }

        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: #2563eb;
            cursor: pointer;
            border: 2px solid #78350f;
            border-radius: 50%;
        }

        .canvas-container {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 4rem;
            border: 2px solid #78350f;
            box-shadow: 6px 6px 0px rgba(120, 53, 15, 0.15);
            background: white;
            width: 100%;
            min-height: 700px;
        }

        #canvasContainer canvas {
            border: 2px solid #78350f !important;
            cursor: crosshair;
            display: block;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            font-size: 0.8rem;
            font-weight: 700;
            color: #92400e;
            text-transform: lowercase;
            margin-top: 0.5rem;
        }

        .stat-val { color: #1d4ed8; }

        .btn-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.625rem;
            margin-bottom: 0.625rem;
        }

        .btn-row .btn { margin-bottom: 0; }

        .inline-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.75rem;
            margin-bottom: 0.75rem;
            align-items: end;
        }

        .inline-label {
            display: block;
            font-size: 0.8rem;
            font-weight: 700;
            text-transform: lowercase;
            color: #78350f;
            margin-bottom: 0.375rem;
        }

        .color-picker-sm {
            width: 100%;
            height: 42px;
            border: 2px solid #78350f;
            border-radius: 4px;
            cursor: pointer;
            display: block;
        }

        footer {
            background: white;
            border-top: 2px solid #78350f;
            padding: 2rem;
            text-align: center;
            width: 100%;
            margin-top: 2rem;
        }

        .contact-links {
            display: flex;
            justify-content: center;
            gap: 1.5rem;
            flex-wrap: wrap;
            margin-bottom: 1.5rem;
        }

        .contact-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 1rem 2rem;
            font-weight: 700;
            text-transform: lowercase;
            text-decoration: none;
            border: 2px solid #78350f;
            transition: all 0.3s;
            box-shadow: 4px 4px 0px rgba(120, 53, 15, 0.2);
        }

        .contact-btn:hover {
            transform: translateY(-2px);
            box-shadow: 6px 6px 0px rgba(120, 53, 15, 0.25);
        }

        .contact-btn.email     { background: #2563eb; color: white; }
        .contact-btn.portfolio { background: #78350f; color: white; }
        .contact-btn.linkedin  { background: #fef3c7; color: #78350f; }

        footer p {
            color: #92400e;
            font-size: 0.875rem;
            font-weight: 700;
            text-transform: lowercase;
            margin: 0.25rem 0;
        }

        @media (max-width: 1024px) {
            .main-layout { grid-template-columns: 280px 1fr; gap: 1.5rem; }
            .controls-panel { padding: 1.5rem; }
        }

        @media (max-width: 768px) {
            .container { padding: 1rem; }
            h1 { font-size: 2.5rem; margin-bottom: 0.5rem; }
            .subtitle { font-size: 1rem; margin-bottom: 2rem; }
            .main-layout { grid-template-columns: 1fr; gap: 1.5rem; }
            .controls-panel { padding: 1.5rem; gap: 1.25rem; position: static; }
            .control-section { padding-bottom: 1.25rem; border-bottom: 2px solid #fef3c7; }
            .control-section:last-child { border-bottom: none; padding-bottom: 0; }
            .canvas-container { padding: 2rem; min-height: 500px; }
            .contact-links { flex-direction: column; align-items: stretch; gap: 1rem; }
            .contact-btn { width: 100%; justify-content: center; }
            footer { padding: 1.5rem 1rem; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>starstruck</h1>
        <p class="subtitle">âœ¶ scatter stars, shape your sky âœ¶</p>

        <div class="main-layout">
            <div class="controls-panel">
                <div class="controls-row">

                    <div class="control-section">
                        <h3>tools</h3>
                        <div class="tool-selector">
                            <button class="tool-btn active" onclick="starToolMode('place', this)">â˜… place</button>
                            <button class="tool-btn" onclick="starToolMode('erase', this)">âŒ« erase</button>
                        </div>
                    </div>

                    <div class="control-section">
                        <h3>drawing</h3>
                        <div class="inline-grid">
                            <div>
                                <label class="inline-label">star color</label>
                                <input type="color" id="starColor" class="color-picker-sm" value="#2563eb">
                            </div>
                            <div>
                                <label class="inline-label">line color</label>
                                <input type="color" id="lineColor" class="color-picker-sm" value="#78350f">
                            </div>
                        </div>
                        <div class="inline-grid" style="margin-bottom:0;">
                            <div>
                                <label class="inline-label">size: <span id="starSizeValue">8</span>px</label>
                                <input type="range" id="starSize" min="2" max="30" value="8">
                            </div>
                            <div>
                                <label class="inline-label">reach: <span id="reachValue">150</span></label>
                                <input type="range" id="reach" min="30" max="400" value="150">
                            </div>
                        </div>
                        <div class="stat-row" style="margin-top:0.75rem;">
                            <span>stars</span><span class="stat-val" id="starCount">0</span>
                        </div>
                        <div class="stat-row">
                            <span>connections</span><span class="stat-val" id="lineCount">0</span>
                        </div>
                    </div>

                    <div class="control-section">
                        <h3>constellations</h3>
                        <button class="btn btn-surprise" onclick="starScatter(event)">âœ¨ surprise me!</button>
                    </div>

                    <div class="control-section">
                        <h3>actions</h3>
                        <div class="btn-row">
                            <button class="btn btn-secondary" onclick="starUndo()">â†© undo</button>
                            <button class="btn btn-secondary" onclick="starRedo()">â†ª redo</button>
                        </div>
                        <button class="btn btn-secondary" onclick="starClearAll()">clear all</button>
                    </div>

                    <div class="control-section">
                        <h3>save</h3>
                        <button class="btn btn-secondary" onclick="starSave('transparent')">transparent</button>
                        <button class="btn btn-secondary" onclick="starSave('_withbg')">with background</button>
                    </div>

                </div>
            </div>

            <div class="canvas-container" id="canvasContainer">
                <!-- p5.js canvas inserted here -->
            </div>
        </div>
    </div>

    <footer>
        <div class="contact-links">
            <a href="/cdn-cgi/l/email-protection#f8968bcacacac1b89b978a969d9494d69d9c8d" class="contact-btn email">
                <span>âœ‰</span><span>email</span>
            </a>
            <a href="https://naishasrivastava.github.io/" target="_blank" class="contact-btn portfolio">
                <span>â˜…</span><span>portfolio</span>
            </a>
            <a href="https://www.linkedin.com/in/naishasrivastava" target="_blank" class="contact-btn linkedin">
                <span>in</span><span>linkedin</span>
            </a>
        </div>
        <p>made with â™¥ by naisha srivastava</p>
        <p>Â© 2026</p>
    </footer>

    <script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>
        // â”€â”€ State (outside p5 so UI buttons can reach it) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        let stars = [];
        let redoStack = [];
        let reach = 150;
        let starRadius = 8;
        let starColHex = '#2563eb';
        let lineColHex = '#78350f';
        let currentStarMode = 'place';
        let canvasSize = 700;
        let dragging = false;
        let p5inst = null;

        // â”€â”€ p5 instance mode â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        const sketch = function(p) {
            p5inst = p;

            p.setup = function() {
                const containerWidth = document.querySelector('.canvas-container').clientWidth;
                canvasSize = Math.min(containerWidth - 150, 750);
                let cnv = p.createCanvas(canvasSize, canvasSize);
                cnv.parent('canvasContainer');

                document.getElementById('reach').addEventListener('input', e => {
                    reach = parseInt(e.target.value);
                    document.getElementById('reachValue').textContent = reach;
                    p.redraw();
                });

                document.getElementById('starSize').addEventListener('input', e => {
                    starRadius = parseInt(e.target.value);
                    document.getElementById('starSizeValue').textContent = starRadius;
                });

                document.getElementById('starColor').addEventListener('input', e => {
                    starColHex = e.target.value;
                });

                document.getElementById('lineColor').addEventListener('input', e => {
                    lineColHex = e.target.value;
                });

                p.noLoop();
            };

            p.draw = function() {
                p.background(8, 8, 20);

                // Nebula patches
                p.noStroke();
                const patches = [
                    { x: p.width * 0.2, y: p.height * 0.3, r: 120, c: p.color(40, 30, 100, 18) },
                    { x: p.width * 0.75, y: p.height * 0.6, r: 160, c: p.color(20, 60, 80, 15) },
                    { x: p.width * 0.5, y: p.height * 0.8, r: 90, c: p.color(80, 20, 60, 12) },
                ];
                for (let patch of patches) {
                    p.fill(patch.c);
                    p.ellipse(patch.x, patch.y, patch.r * 2.5, patch.r);
                }

                // Connection lines
                let lineCount = 0;
                const lc = p.color(lineColHex);
                for (let i = 0; i < stars.length; i++) {
                    for (let j = i + 1; j < stars.length; j++) {
                        const d = p.dist(stars[i].x, stars[i].y, stars[j].x, stars[j].y);
                        if (d < reach) {
                            const alpha = p.map(d, 0, reach, 200, 20);
                            p.stroke(p.red(lc), p.green(lc), p.blue(lc), alpha);
                            p.strokeWeight(p.map(d, 0, reach, 1.5, 0.3));
                            p.line(stars[i].x, stars[i].y, stars[j].x, stars[j].y);
                            lineCount++;
                        }
                    }
                }

                // Stars
                p.noStroke();
                for (let s of stars) {
                    const sc = p.color(s.colHex);
                    for (let g = 4; g > 0; g--) {
                        const glowAlpha = p.map(g, 4, 1, 15, 80);
                        p.fill(p.red(sc), p.green(sc), p.blue(sc), glowAlpha);
                        p.ellipse(s.x, s.y, s.r * 2 + g * 4);
                    }
                    p.fill(sc);
                    p.ellipse(s.x, s.y, s.r * 2);
                    p.fill(255, 255, 255, 180);
                    p.ellipse(s.x, s.y, s.r * 0.6);
                }

                // Reach preview ring
                if (!dragging && p.mouseX > 0 && p.mouseX < p.width && p.mouseY > 0 && p.mouseY < p.height) {
                    p.noFill();
                    p.stroke(255, 255, 255, 20);
                    p.strokeWeight(1);
                    p.ellipse(p.mouseX, p.mouseY, reach * 2);
                }

                document.getElementById('starCount').textContent = stars.length;
                document.getElementById('lineCount').textContent = lineCount;
            };

            p.mousePressed = function() {
                if (p.mouseX < 0 || p.mouseX > p.width || p.mouseY < 0 || p.mouseY > p.height) return;
                dragging = true;
                if (currentStarMode === 'place') {
                    placeStar(p.mouseX, p.mouseY, p);
                } else {
                    eraseNear(p.mouseX, p.mouseY, p);
                }
                p.redraw();
            };

            p.mouseDragged = function() {
                if (p.mouseX < 0 || p.mouseX > p.width || p.mouseY < 0 || p.mouseY > p.height) return;
                if (currentStarMode === 'place') {
                    const last = stars[stars.length - 1];
                    if (!last || p.dist(p.mouseX, p.mouseY, last.x, last.y) > starRadius * 3) {
                        placeStar(p.mouseX, p.mouseY, p);
                    }
                } else {
                    eraseNear(p.mouseX, p.mouseY, p);
                }
                p.redraw();
            };

            p.mouseReleased = function() { dragging = false; p.redraw(); };
            p.mouseMoved   = function() { p.redraw(); };

            p.windowResized = function() {
                const cw = document.querySelector('.canvas-container').clientWidth;
                const newSize = Math.min(cw - 150, 750);
                if (newSize !== canvasSize) {
                    const scale = newSize / canvasSize;
                    canvasSize = newSize;
                    p.resizeCanvas(canvasSize, canvasSize);
                    stars = stars.map(s => ({ ...s, x: s.x * scale, y: s.y * scale }));
                    p.redraw();
                }
            };
        };

        new p5(sketch);

        // â”€â”€ Helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        function placeStar(x, y, p) {
            redoStack = [];
            stars.push({
                x, y,
                r: starRadius * (0.7 + Math.random() * 0.6),
                colHex: starColHex,
                twinkle: Math.random() * Math.PI * 2
            });
        }

        function eraseNear(x, y, p) {
            const eraseR = starRadius * 3;
            stars = stars.filter(s => Math.hypot(s.x - x, s.y - y) > eraseR);
        }

        // â”€â”€ UI button handlers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        function starToolMode(mode, el) {
            currentStarMode = mode;
            document.querySelectorAll('.tool-btn').forEach(b => b.classList.remove('active'));
            if (el) el.classList.add('active');
        }

        function starUndo() {
            if (stars.length === 0) return;
            redoStack.push(stars.pop());
            if (p5inst) p5inst.redraw();
        }

        function starRedo() {
            if (redoStack.length === 0) return;
            stars.push(redoStack.pop());
            if (p5inst) p5inst.redraw();
        }

        function starClearAll() {
            stars = []; redoStack = [];
            if (p5inst) p5inst.redraw();
        }

        function starSave(mode) {
            if (!p5inst) return;

            const DPR = 3; // 3x resolution for high quality export
            const W = canvasSize * DPR;

            const offscreen = document.createElement('canvas');
            offscreen.width = W;
            offscreen.height = W;
            const ctx = offscreen.getContext('2d');

            // Scale everything up by DPR
            ctx.scale(DPR, DPR);

            // Background
            if (mode === '_withbg') {
                ctx.fillStyle = 'rgb(8,8,20)';
                ctx.fillRect(0, 0, canvasSize, canvasSize);
                // Nebula patches
                const nebulas = [
                    { x: canvasSize*0.2,  y: canvasSize*0.3,  rw: 300, rh: 120, r:'40,30,100',  a: 0.07 },
                    { x: canvasSize*0.75, y: canvasSize*0.6,  rw: 400, rh: 160, r:'20,60,80',   a: 0.06 },
                    { x: canvasSize*0.5,  y: canvasSize*0.8,  rw: 225, rh: 90,  r:'80,20,60',   a: 0.05 },
                ];
                for (let n of nebulas) {
                    const grad = ctx.createRadialGradient(n.x, n.y, 0, n.x, n.y, n.rw / 2);
                    grad.addColorStop(0, `rgba(${n.r},${n.a})`);
                    grad.addColorStop(1, `rgba(${n.r},0)`);
                    ctx.save();
                    ctx.scale(1, n.rh / n.rw);
                    ctx.fillStyle = grad;
                    ctx.beginPath();
                    ctx.arc(n.x, n.y * (n.rw / n.rh), n.rw / 2, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.restore();
                }
            }
            // transparent mode â€” ctx is clear by default

            function hexToRgb(hex) {
                return {
                    r: parseInt(hex.slice(1,3),16),
                    g: parseInt(hex.slice(3,5),16),
                    b: parseInt(hex.slice(5,7),16)
                };
            }

            // Connection lines
            const lc = hexToRgb(lineColHex);
            for (let i = 0; i < stars.length; i++) {
                for (let j = i + 1; j < stars.length; j++) {
                    const dx = stars[j].x - stars[i].x;
                    const dy = stars[j].y - stars[i].y;
                    const d = Math.sqrt(dx*dx + dy*dy);
                    if (d < reach) {
                        const alpha = (1 - d / reach) * 0.8;
                        const weight = 0.3 + (1 - d / reach) * 1.2;
                        ctx.strokeStyle = `rgba(${lc.r},${lc.g},${lc.b},${alpha})`;
                        ctx.lineWidth = weight;
                        ctx.beginPath();
                        ctx.moveTo(stars[i].x, stars[i].y);
                        ctx.lineTo(stars[j].x, stars[j].y);
                        ctx.stroke();
                    }
                }
            }

            // Stars
            for (let s of stars) {
                const sc = hexToRgb(s.colHex);
                for (let g = 4; g > 0; g--) {
                    const glowAlpha = (5 - g) / 4 * 0.3;
                    const glowR = s.r + g * 2;
                    const grad = ctx.createRadialGradient(s.x, s.y, 0, s.x, s.y, glowR);
                    grad.addColorStop(0, `rgba(${sc.r},${sc.g},${sc.b},${glowAlpha})`);
                    grad.addColorStop(1, `rgba(${sc.r},${sc.g},${sc.b},0)`);
                    ctx.fillStyle = grad;
                    ctx.beginPath();
                    ctx.arc(s.x, s.y, glowR, 0, Math.PI * 2);
                    ctx.fill();
                }
                ctx.fillStyle = `rgb(${sc.r},${sc.g},${sc.b})`;
                ctx.beginPath();
                ctx.arc(s.x, s.y, s.r, 0, Math.PI * 2);
                ctx.fill();
                ctx.fillStyle = 'rgba(255,255,255,0.7)';
                ctx.beginPath();
                ctx.arc(s.x, s.y, s.r * 0.3, 0, Math.PI * 2);
                ctx.fill();
            }

            const filename = mode === '_withbg' ? 'starstruck_withbg.png' : 'starstruck.png';
            offscreen.toBlob(blob => {
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                a.click();
                URL.revokeObjectURL(url);
            }, 'image/png');
        }

        // â”€â”€ Templates â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        function starScatter(e) {
            sparkleBtn(e);
            stars = []; redoStack = [];
            const count = Math.floor(30 + Math.random() * 40);
            const palette = ['#2563eb','#fde68a','#9B87F5','#ffffff','#f97316','#06b6d4'];
            for (let i = 0; i < count; i++) {
                stars.push({
                    x: 40 + Math.random() * (canvasSize - 80),
                    y: 40 + Math.random() * (canvasSize - 80),
                    r: starRadius * (0.5 + Math.random() * 0.9),
                    colHex: palette[Math.floor(Math.random() * palette.length)],
                    twinkle: Math.random() * Math.PI * 2
                });
            }
            if (p5inst) p5inst.redraw();
        }

        function sparkleBtn(e) {
            if (!e) return;
            const btn = e.currentTarget;
            const emojis = ['âœ¨','â­','ðŸ’«','ðŸŒŸ','âœ¦'];
            for (let i = 0; i < 5; i++) {
                setTimeout(() => {
                    const span = document.createElement('span');
                    span.className = 'sparkle';
                    span.textContent = emojis[Math.floor(Math.random() * emojis.length)];
                    span.style.left = (15 + Math.random() * 70) + '%';
                    span.style.top  = (15 + Math.random() * 70) + '%';
                    btn.appendChild(span);
                    setTimeout(() => span.remove(), 700);
                }, i * 100);
            }
        }
    </script>
</body>
</html>
